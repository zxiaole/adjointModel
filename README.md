# adjointModel
This is a case study to combine the source oriented and receptor source apportionment methods based on the measurements during Feb.7 to Feb.11, 2021.

## Preparation
Now we have a long queue to download the meteo data from ECMWF. The precessing tools in Polyphemus need the meteo data saved by days. To shorten the queueing time, we download all the data for the calculation period once. Then use the [grib_filter](https://confluence.ecmwf.int/display/ECC/grib_filter) in the grib tools to split the whole data into days.

Install the grib api tools
> sudo apt-get install libgrib-api-tools

## Meteorological data preparation
* Meteorological data: the adjoint model should run backward in time. Considering the measurements duration, we decided to prepare the meteorological data covering whole January until Feb. 12, 2021. 

To split the file, in "rules_file"
> write "[centre]_[date].grib";

Then, run the grib_filter to split the data file
> grib_filter rules_file SingleLevel_20210101.grib 

where SingleLevel_20210101.grib is the downloaded file

[Xygrib](https://opengribs.org/en/) can be used to overview the generated data files, and check the file information, including area and numbers of grid points.

* [preProcessing.py](preProcessing.py): generate the model-ready ground data and meteorological data for Polair3d model.

## Emission data preparation
* Temporal profile: use the newly developed [high resolution emission profiles in EDGAR](https://edgar.jrc.ec.europa.eu/dataset_temp_profile). The hourly profile is generated by the combination of weekly factors and daily factors.

